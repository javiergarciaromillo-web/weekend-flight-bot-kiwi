<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ subject }}</title>
</head>
<body style="font-family: Arial, Helvetica, sans-serif; background:#ffffff; color:#111; margin:0; padding:24px;">
  <div style="max-width:900px; margin:0 auto;">

    <div style="border:1px solid #e5e7eb; border-radius:12px; padding:16px 18px;">
      <div style="font-size:20px; font-weight:800; margin-bottom:6px;">
        {{ header }}
      </div>
      <div style="font-size:12px; color:#6b7280;">
        Window {{ time_from }}–{{ time_to }} | {{ weeks }} weeks | Timezone {{ tz_name }}
      </div>
      <div style="font-size:12px; color:#6b7280; margin-top:4px;">
        Run: {{ run_date }}
      </div>
    </div>

    {% for w in weekends %}
      <div style="margin-top:16px; border:1px solid #e5e7eb; border-radius:12px; padding:14px 16px;">
        <div style="font-size:16px; font-weight:800; margin-bottom:10px;">
          Weekend starting {{ w.week_start }} ({{ w.thu }} → {{ w.mon }})
        </div>

        {% for block in w.blocks %}
          <div style="margin-top:12px;">
            <div style="font-size:13px; font-weight:800;">
              {{ block.title }}
              <span style="font-size:12px; color:#6b7280; font-weight:600;">({{ block.date }})</span>
            </div>

            {% if block.items and (block.items|length) > 0 %}
              <div style="margin-top:8px; border:1px solid #eef2f7; border-radius:10px; padding:10px 12px;">
                {% for it in block.items %}
                  <div style="font-size:12px; line-height:1.8;">
                    <span style="font-weight:800;">{{ it.flight_code }}</span>
                    <span style="color:#374151;">{{ it.origin }}→{{ it.destination }}</span>
                    <span style="color:#111;">{{ it.depart }}–{{ it.arrive }}</span>

                    {% if it.price_eur is not none %}
                      <span style="font-weight:900;">€{{ "%.2f"|format(it.price_eur) }}</span>
                    {% else %}
                      <span style="color:#6b7280;">n/a</span>
                    {% endif %}

                    {% if it.delta is not none %}
                      {% if it.delta > 0 %}
                        <span style="color:#b91c1c; font-weight:800;">↑ {{ "%.2f"|format(it.delta) }}</span>
                      {% elif it.delta < 0 %}
                        <span style="color:#047857; font-weight:800;">↓ {{ "%.2f"|format(-it.delta) }}</span>
                      {% else %}
                        <span style="color:#6b7280;">= 0.00</span>
                      {% endif %}
                      <span style="color:#6b7280;">vs prev</span>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div style="margin-top:8px; font-size:12px; color:#6b7280;">
                No matches found.
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}

  </div>
</body>
</html>
